import React, { useState } from 'react';
import { Search, ArrowLeft, Music, Play, Plus, Edit, Trash2, Save, X } from 'lucide-react';

const SingerGallery = () = {
  const [searchTerm, setSearchTerm] = useState('');
  const [currentView, setCurrentView] = useState('gallery');  'gallery', 'youtube', 'admin'
  const [selectedSinger, setSelectedSinger] = useState(null);
  const [editingId, setEditingId] = useState(null);
  const [showAddForm, setShowAddForm] = useState(false);

   Stato per il form di aggiuntamodifica
  const [formData, setFormData] = useState({
    name '',
    image '',
    youtubeUrl ''
  });

   Database di cantanti (ora gestito con useState per permettere modifiche)
  const [singers, setSingers] = useState([
    {
      id 1,
      name Ed Sheeran,
      image httpsimages.unsplash.comphoto-1493225457124-a3eb161ffa5fw=300&h=300&fit=crop&crop=face,
      youtubeUrl httpswww.youtube.comcEdSheeran,
      genre Pop
    },
    {
      id 2,
      name Billie Eilish,
      image httpsimages.unsplash.comphoto-1516450360452-9312f5e86fc7w=300&h=300&fit=crop&crop=face,
      youtubeUrl httpswww.youtube.comcBillieEilish,
      genre Alternative
    },
    {
      id 3,
      name Bruno Mars,
      image httpsimages.unsplash.comphoto-1511671782779-c97d3d27a1d4w=300&h=300&fit=crop&crop=face,
      youtubeUrl httpswww.youtube.comcBrunoMars,
      genre PopFunk
    },
    {
      id 4,
      name Ariana Grande,
      image httpsimages.unsplash.comphoto-1494790108755-2616c6d5e78ew=300&h=300&fit=crop&crop=face,
      youtubeUrl httpswww.youtube.comcArianaGrande,
      genre Pop
    },
    {
      id 5,
      name The Weeknd,
      image httpsimages.unsplash.comphoto-1507003211169-0a1dd7228f2dw=300&h=300&fit=crop&crop=face,
      youtubeUrl httpswww.youtube.comcTheWeeknd,
      genre R&B
    },
    {
      id 6,
      name Taylor Swift,
      image httpsimages.unsplash.comphoto-1438761681033-6461ffad8d80w=300&h=300&fit=crop&crop=face,
      youtubeUrl httpswww.youtube.comcTaylorSwift,
      genre PopCountry
    }
  ]);

  const handleSingerClick = (singer) = {
    setSelectedSinger(singer);
    setCurrentView('youtube');
  };

  const handleBackToGallery = () = {
    setCurrentView('gallery');
    setSelectedSinger(null);
    setEditingId(null);
    setShowAddForm(false);
  };

  const handleEdit = (singer, e) = {
    e.stopPropagation();
    setEditingId(singer.id);
    setFormData({
      name singer.name,
      image singer.image,
      youtubeUrl singer.youtubeUrl
    });
  };

  const handleDelete = (singerId, e) = {
    e.stopPropagation();
    if (confirm('Sei sicuro di voler eliminare questo cantante')) {
      setSingers(singers.filter(s = s.id !== singerId));
    }
  };

  const handleSave = (singerId) = {
    if (!formData.name) {
      alert('Nome è obbligatorio!');
      return;
    }

    setSingers(singers.map(s = 
      s.id === singerId 
         { ...s, ...formData, genre s.genre  'Musica' }
         s
    ));
    setEditingId(null);
  };

  const handleAdd = () = {
    if (!formData.name) {
      alert('Nome è obbligatorio!');
      return;
    }

    const newSinger = {
      id Math.max(...singers.map(s = s.id)) + 1,
      ...formData,
      genre formData.genre  'Musica',
      image formData.image  'httpsimages.unsplash.comphoto-1493225457124-a3eb161ffa5fw=300&h=300&fit=crop&crop=face'
    };

    setSingers([...singers, newSinger]);
    setShowAddForm(false);
    setFormData({ name '', image '', youtubeUrl '' });
  };

  const handleCancel = () = {
    setEditingId(null);
    setShowAddForm(false);
    setFormData({ name '', image '', youtubeUrl '' });
  };

  const filteredSingers = singers.filter(singer =
    singer.name.toLowerCase().includes(searchTerm.toLowerCase()) 
    singer.genre.toLowerCase().includes(searchTerm.toLowerCase())
  );

   Vista YouTube
  if (currentView === 'youtube' && selectedSinger) {
    return (
      div className=min-h-screen bg-black text-white
        div className=bg-red-600 p-4 shadow-lg
          div className=max-w-6xl mx-auto flex items-center gap-4
            button 
              onClick={handleBackToGallery}
              className=flex items-center gap-2 bg-white text-red-600 px-4 py-2 rounded-full hoverbg-gray-100 transition-colors font-semibold
            
              ArrowLeft size={20} 
              Torna ai Cantanti
            button
            div className=flex items-center gap-3
              Music className=text-white size={24} 
              h1 className=text-2xl font-bold{selectedSinger.name}h1
              span className=bg-red-800 px-3 py-1 rounded-full text-sm{selectedSinger.genre}span
            div
          div
        div

        div className=p-4
          div className=max-w-6xl mx-auto
            div className=bg-gray-900 rounded-lg overflow-hidden shadow-2xl
              iframe
                width=100%
                height=600
                src={`httpswww.youtube.comembedvideoserieslist=PLrAl6rYGRamxGpZfhT7pTDDyT9CTfhLj1&autoplay=1`}
                title={`${selectedSinger.name} YouTube Channel`}
                frameBorder=0
                allow=accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share
                allowFullScreen
                className=w-full
              iframe
              div className=p-4
                div className=flex items-center gap-4
                  img 
                    src={selectedSinger.image} 
                    alt={selectedSinger.name}
                    className=w-16 h-16 rounded-full object-cover border-2 border-red-500
                  
                  div
                    h2 className=text-xl font-bold text-white{selectedSinger.name}h2
                    p className=text-gray-400{selectedSinger.genre}p
                  div
                  a 
                    href={selectedSinger.youtubeUrl}
                    target=_blank
                    rel=noopener noreferrer
                    className=ml-auto bg-red-600 hoverbg-red-700 text-white px-6 py-2 rounded-full font-semibold transition-colors flex items-center gap-2
                  
                    Play size={16} 
                    Vai su YouTube
                  a
                div
              div
            div
          div
        div
      div
    );
  }

   Vista principale galleria
  return (
    div className=min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900
      { Header }
      div className=bg-black30 backdrop-blur-sm shadow-lg
        div className=max-w-7xl mx-auto p-6
          div className=flex items-center justify-center gap-3 mb-6
            Music className=text-white size={32} 
            h1 className=text-4xl font-bold text-whiteGalleria Cantantih1
          div
          
          { Barra di ricerca e pulsante aggiungi }
          div className=flex gap-4 items-center max-w-2xl mx-auto
            div className=relative flex-1
              Search className=absolute left-3 top-12 transform -translate-y-12 text-gray-400 size={20} 
              input
                type=text
                placeholder=Cerca cantante o genere...
                value={searchTerm}
                onChange={(e) = setSearchTerm(e.target.value)}
                className=w-full pl-10 pr-4 py-3 bg-white90 backdrop-blur-sm rounded-full border-2 border-white20 focusoutline-none focusborder-purple-400 text-gray-800 placeholder-gray-500
              
            div
            button
              onClick={() = setShowAddForm(true)}
              className=bg-green-600 hoverbg-green-700 text-white px-6 py-3 rounded-full font-semibold transition-colors flex items-center gap-2
            
              Plus size={20} 
              Aggiungi Cantante
            button
          div
        div
      div

      { Form di aggiunta }
      {showAddForm && (
        div className=max-w-2xl mx-auto p-6
          div className=bg-white10 backdrop-blur-sm rounded-2xl p-6 shadow-xl border border-white20
            h3 className=text-2xl font-bold text-white mb-4Aggiungi Nuovo Cantanteh3
            div className=space-y-4
              input
                type=text
                placeholder=Nome cantante 
                value={formData.name}
                onChange={(e) = setFormData({...formData, name e.target.value})}
                className=w-full p-3 bg-white20 border border-white30 rounded-lg text-white placeholder-gray-300 focusoutline-none focusborder-purple-400
              
              input
                type=url
                placeholder=URL immagine (opzionale)
                value={formData.image}
                onChange={(e) = setFormData({...formData, image e.target.value})}
                className=w-full p-3 bg-white20 border border-white30 rounded-lg text-white placeholder-gray-300 focusoutline-none focusborder-purple-400
              
              input
                type=url
                placeholder=URL YouTube (opzionale)
                value={formData.youtubeUrl}
                onChange={(e) = setFormData({...formData, youtubeUrl e.target.value})}
                className=w-full p-3 bg-white20 border border-white30 rounded-lg text-white placeholder-gray-300 focusoutline-none focusborder-purple-400
              
            div
            div className=flex gap-3 mt-4
              button
                onClick={handleAdd}
                className=flex items-center gap-2 bg-green-600 hoverbg-green-700 text-white px-4 py-2 rounded-full transition-colors
              
                Save size={16} 
                Aggiungi
              button
              button
                onClick={handleCancel}
                className=flex items-center gap-2 bg-gray-600 hoverbg-gray-700 text-white px-4 py-2 rounded-full transition-colors
              
                X size={16} 
                Annulla
              button
            div
          div
        div
      )}

      { Galleria cantanti }
      div className=max-w-7xl mx-auto p-6
        div className=grid grid-cols-2 smgrid-cols-3 mdgrid-cols-4 lggrid-cols-5 xlgrid-cols-6 gap-4
          {filteredSingers.map((singer) = (
            div
              key={singer.id}
              className=group transform hoverscale-105 transition-all duration-300
            
              {editingId === singer.id  (
                 Form di modifica 
                div className=bg-white10 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white10
                  div className=space-y-3
                    input
                      type=text
                      value={formData.name}
                      onChange={(e) = setFormData({...formData, name e.target.value})}
                      className=w-full p-2 bg-white20 border border-white30 rounded-lg text-white placeholder-gray-300 focusoutline-none focusborder-purple-400 text-sm
                      placeholder=Nome
                    
                    input
                      type=url
                      value={formData.image}
                      onChange={(e) = setFormData({...formData, image e.target.value})}
                      className=w-full p-2 bg-white20 border border-white30 rounded-lg text-white placeholder-gray-300 focusoutline-none focusborder-purple-400 text-sm
                      placeholder=URL immagine
                    
                    input
                      type=url
                      value={formData.youtubeUrl}
                      onChange={(e) = setFormData({...formData, youtubeUrl e.target.value})}
                      className=w-full p-2 bg-white20 border border-white30 rounded-lg text-white placeholder-gray-300 focusoutline-none focusborder-purple-400 text-sm
                      placeholder=URL YouTube
                    
                    div className=flex gap-2
                      button
                        onClick={() = handleSave(singer.id)}
                        className=flex items-center gap-1 bg-green-600 hoverbg-green-700 text-white px-3 py-1 rounded-full transition-colors text-sm
                      
                        Save size={14} 
                        Salva
                      button
                      button
                        onClick={handleCancel}
                        className=flex items-center gap-1 bg-gray-600 hoverbg-gray-700 text-white px-3 py-1 rounded-full transition-colors text-sm
                      
                        X size={14} 
                        Annulla
                      button
                    div
                  div
                div
              )  (
                 Card normale 
                div
                  onClick={() = handleSingerClick(singer)}
                  className=cursor-pointer
                
                  div className=bg-white10 backdrop-blur-sm rounded-2xl p-4 shadow-xl hovershadow-2xl hoverbg-white20 transition-all duration-300 border border-white10 relative
                    { Pulsanti di controllo }
                    div className=absolute top-1 right-1 flex gap-1 opacity-0 group-hoveropacity-100 transition-opacity duration-300 z-10
                      button
                        onClick={(e) = handleEdit(singer, e)}
                        className=bg-blue-600 hoverbg-blue-700 text-white p-1 rounded-full transition-colors
                      
                        Edit size={12} 
                      button
                      button
                        onClick={(e) = handleDelete(singer.id, e)}
                        className=bg-red-600 hoverbg-red-700 text-white p-1 rounded-full transition-colors
                      
                        Trash2 size={12} 
                      button
                    div

                    div className=relative overflow-hidden rounded-xl mb-2
                      img
                        src={singer.image}
                        alt={singer.name}
                        className=w-full h-48 object-cover group-hoverscale-110 transition-transform duration-300
                      
                      div className=absolute inset-0 bg-gradient-to-t from-black50 to-transparent opacity-0 group-hoveropacity-100 transition-opacity duration-300 flex items-center justify-center
                        Play className=text-white bg-red-600 p-2 rounded-full size={24} 
                      div
                    div
                    
                    div className=text-center
                      h3 className=text-xl font-bold text-white mb-2 group-hovertext-purple-300 transition-colors
                        {singer.name}
                      h3
                      span className=inline-block bg-purple-60080 text-white px-3 py-1 rounded-full text-sm font-medium
                        {singer.genre}
                      span
                    div
                  div
                div
              )}
            div
          ))}
        div

        {filteredSingers.length === 0 && (
          div className=text-center py-12
            Music className=mx-auto text-white50 mb-4 size={64} 
            p className=text-white80 text-xlNessun cantante trovato con questi criterip
          div
        )}
      div
    div
  );
};

export default SingerGallery;